<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <title>Uji Tingkat Konsentrasi</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta content="Premium Multipurpose Admin & Dashboard Template" name="description" />
    <meta content="Themesdesign" name="author" />
    <!-- App favicon -->
    <link href="https://apps.multi.co.id/myassetv3/assets/libs/select2/css/select2.min.css" rel="stylesheet" type="text/css">
    <link href="https://apps.multi.co.id/myassetv3/assets/libs/bootstrap-touchspin/jquery.bootstrap-touchspin.min.css" rel="stylesheet">

    <!-- DataTables -->
    <link href="https://apps.multi.co.id/myassetv3/assets/libs/datatables.net-bs4/css/dataTables.bootstrap4.min.css" rel="stylesheet" type="text/css" />
    <link href="https://apps.multi.co.id/myassetv3/assets/libs/datatables.net-buttons-bs4/css/buttons.bootstrap4.min.css" rel="stylesheet" type="text/css" />
    <link href="https://apps.multi.co.id/myassetv3/assets/libs/datatables.net-select-bs4/css/select.bootstrap4.min.css" rel="stylesheet" type="text/css" />

    <!-- Lightbox css -->
    <link href="https://apps.multi.co.id/myassetv3/assets/libs/magnific-popup/magnific-popup.css" rel="stylesheet" type="text/css" />

    <!-- Bootstrap Css -->
    <link href="https://apps.multi.co.id/myassetv3/assets/css/bootstrap.min.css" id="bootstrap-style" rel="stylesheet" type="text/css" />
    <!-- Icons Css -->
    <link href="https://apps.multi.co.id/myassetv3/assets/css/icons.min.css" rel="stylesheet" type="text/css" />
    <link href="https://cdn.jsdelivr.net/npm/remixicon@2.5.0/fonts/remixicon.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/@mdi/font@6.5.95/css/materialdesignicons.min.css" rel="stylesheet">

    <!-- App Css-->
    <link href="https://apps.multi.co.id/myassetv3/assets/css/app.min.css" id="app-style" rel="stylesheet" type="text/css" />

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.14/dist/css/bootstrap-select.min.css">

    <!-- App favicon -->
    <link rel="shortcut icon" href="">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://apps.multi.co.id/myassetv3/assets/libs/jquery/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.14/dist/js/bootstrap-select.min.js"></script>

</head>


<body data-topbar="dark" data-layout="horizontal">

    <!-- Begin page -->
    <div id="layout-wrapper">
        <header id="page-topbar">
            <div class="navbar-header">
                <div class="d-flex">
                    <!-- LOGO -->
                    <div class="navbar-brand-box">
                        <a class="navbar-brand mt-2 mt-lg-0" style="color: white;">
                            Uji Konsentrasi
                        </a>
                    </div>

                    <button type="button" class="btn btn-sm px-3 font-size-18 d-lg-none header-item" data-bs-toggle="collapse" data-bs-target="#topnav-menu-content">
                        <i class="fa fa-fw fa-bars align-middle"></i>
                    </button>
                </div>

                <div class="d-flex">
                    {% if 'username' in session %}
                    <div class="dropdown d-inline-block user-dropdown">
                        <button type="button" class="btn header-item waves-effect" id="page-header-user-dropdown" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            {{ session['nama_pegawai'] }} <img class="rounded-circle header-profile-user" src="https://www.unikom.ac.id/img/logo_unikom_kuning.png" alt="Header Avatar">
                        </button>
                        <div class="dropdown-menu dropdown-menu-lg dropdown-menu-end">
                            <div class="p-3">
                                <div class="row align-items-center">
                                    <div class="col">
                                        <h6 class="m-0"> {{ session['nama_pegawai'] }} </h6>
                                    </div>
                                    <!-- <div class="col-auto">
                                        <a class="small"> Available</a>
                                    </div> -->
                                </div>
                            </div>
                            <div class="pt-2">
                                <div class="d-grid card-body">
                                    <a class="btn btn-sm btn-light font-size-14 text-center" href="{{ url_for('login') }}">
                                        <i class="ri-settings-4-line align-middle me-1"></i> Pengaturan
                                    </a>
                                    <a class="mt-2 btn btn-sm btn-danger font-size-14 text-center" href="{{ url_for('login') }}">
                                        <i class="ri-shut-down-line align-middle me-1"></i> Logout
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>
        </header>

        <div class="main-content">
            <div class="page-content">
                <div class="container-fluid">
                    <div class="row">
                        <!-- Card upload data -->
                        <div class="col-4">
                            <div class="card">
                                <div class="card-body">
                                    <h4 class="card-title text-center">Uji Tingkat Konsentrasi</h4>
                                    <!-- form login -->
                                    <form method="post" enctype="multipart/form-data" action="{{url_for('upload_csv')}}">
                                        <div class="mb-3">
                                            <label for="nip" class="form-label">NIK</label>
                                            <input type="text" class="form-control" id="nip" name="nip" placeholder="Masukkan NIP" pattern="[0-9]{1,8}" title="NIP Harus terdiri dari angka dan maksimal 8 karakter" required>
                                        </div>
                                        <div class="mb-3">
                                            <label for="nama_pegawai" class="form-label">Nama Pegawai</label>
                                            <input type="text" class="form-control" id="nama_pegawai" name="nama_pegawai" placeholder="Masukkan Nama pegawai" required>
                                        </div>
                                        <div class="mb-3">
                                            <label for="departemen" class="from-label">Departemen</label>
                                            <!-- <select class="from-select" id="departemen" name="departemen"> -->
                                            <select class="form-control selectpicker" id="departemen" name="departemen">
                                                <option value="information_technology">Information Technology</option>
                                                <option value="human_capital">Human Capital</option>
                                                <option value="finance">Finance</option>
                                                <option value="general_affair">General Affair</option>
                                            </select>
                                        </div>
                                        <div class="mb-3">
                                            <label for="file" class="from-label">Upload File</label>
                                            <input type="file" class="form-control" id="file" name="csv_file" accept=".csv" required>
                                            {% if response_message== 'CSV file uploaded successfully' %}
                                            <small style="color: blue;">
                                                {{response_message}}
                                            </small>
                                            {% else %}
                                            <small style="color: red;">
                                                {{response_message}}
                                            </small>
                                            {% endif %}

                                            <!-- Display result -->
                                            {% if result %}
                                            <div class="result-container">
                                                <h4>Result:</h4>
                                                <p>{{ result }}</p> <!-- Change this to display specific elements of 'result' as needed -->
                                            </div>
                                            {% endif %}

                                        </div>
                                        <div class="d-grid">
                                            <button type="submit" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#messageModal">Uji Sekarang</button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>

                        <div class="col-8">
                            <div class="card">
                                <div class="card-body">
                                    <h4 class="card-title text-center">History</h4>
                                    <div class="row">
                                        <div class="table-responsive">
                                            <table id="datatable" class="table table-bordered" style="width: 100%;">
                                                <thead>
                                                    <tr>
                                                        <th>No</th>
                                                        <th>NIP</th>
                                                        <th>Nama Pegawai</th>
                                                        <th>Departemen</th>
                                                        <th>Tingkat Konsentrasi</th>
                                                        <th>Tanggal</th>
                                                        <th>Aksi</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    {% for data in data %}
                                                    <tr>
                                                        <td>{{loop.index}} </td>
                                                        <td>{{ data.nip }}</td>
                                                        <td>{{ data.nama_pegawai }}</td>
                                                        <td>{{ data.departemen }}</td>
                                                        <td>{{ data.tingkat_konsentrasi }}</td>
                                                        <td>{{ data.tanggal }}</td>
                                                        <td>
                                                            <a href="#" data-toggle="modal" data-target="#modChart" data-uji="0.08185722, 0.09502756, 0.04491122, 0.06503574, 0.05635585, 0.03786717, 0.08185722, 0.09502756, 0.04491122" data-item="0.02269997, 0.01751783, 0.03700718, 0.04299396, 0.0460799, 0.03779127, 0.02269997, 0.01751783, 0.03700718">
                                                                <span class="ri-bar-chart-2-line"></span> {{ data.nama_pegawai }}
                                                            </a>
                                                        </td>
                                                    </tr>
                                                    {% endfor %}
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- end page title -->
                </div> <!-- container-fluid -->
            </div>
            <!-- End Page-content -->
            <footer class="footer">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-sm-6">
                            <script>
                                document.write(new Date().getFullYear())
                            </script> © All rights reserved.
                        </div>
                        <div class="col-sm-6">
                            <div class="text-sm-end d-none d-sm-block">
                                Aditya Firmansyah
                            </div>
                        </div>
                    </div>
                </div>
            </footer>
        </div>
        <!-- end main content-->

    </div>
    <!-- END layout-wrapper -->

    <!-- Modal -->
    <div class="modal fade" id="modChart" tabindex="-1" role="dialog" aria-labelledby="Modal" aria-hidden="true">
        <div class="modal-dialog modal-xl" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modChart-modal-title" id="ModalLabel">Chart</h5>
                    <button type="button" class="btn-close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true"><span class="sr-only">Close</span>
                    </button>
                </div>
                <div class="modal-body">
                    <CENTER>
                        <div class="chart-cell">
                            <canvas id="canvas" width="1000" height="450"></canvas>
                        </div><br>
                    </CENTER>
                    <div class="row">
                        <div class="dataitem_arr text-danger"></div>
                        <div class="datauji_arr"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Script untuk pencarian -->
    <!-- <script src="{{url_for('static', filename='js/search.js')}}"></script> -->
    <!-- <script src="{{url_for('static', filename='js/filter.js')}}"></script> -->

    <script src="https://apps.multi.co.id/myassetv3/assets/libs/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="https://apps.multi.co.id/myassetv3/assets/libs/metismenu/metisMenu.min.js"></script>
    <script src="https://apps.multi.co.id/myassetv3/assets/libs/simplebar/simplebar.min.js"></script>
    <script src="https://apps.multi.co.id/myassetv3/assets/libs/node-waves/waves.min.js"></script>

    <script src="https://apps.multi.co.id/myassetv3/assets/libs/select2/js/select2.min.js"></script>
    <script src="https://apps.multi.co.id/myassetv3/assets/libs/bootstrap-datepicker/js/bootstrap-datepicker.min.js"></script>
    <script src="https://apps.multi.co.id/myassetv3/assets/libs/spectrum-colorpicker2/spectrum.min.js"></script>
    <script src="https://apps.multi.co.id/myassetv3/assets/libs/bootstrap-touchspin/jquery.bootstrap-touchspin.min.js"></script>
    <script src="https://apps.multi.co.id/myassetv3/assets/libs/admin-resources/bootstrap-filestyle/bootstrap-filestyle.min.js"></script>

    <!-- Datatable init js -->
    <script src="https://apps.multi.co.id/myassetv3/assets/js/pages/form-validation.init.js"></script>

    <!-- jquery.vectormap map -->
    <script src="https://apps.multi.co.id/myassetv3/assets/libs/admin-resources/jquery.vectormap/jquery-jvectormap-1.2.2.min.js"></script>
    <script src="https://apps.multi.co.id/myassetv3/assets/libs/admin-resources/jquery.vectormap/maps/jquery-jvectormap-us-merc-en.js"></script>


    <!-- Required datatable js -->
    <script src="https://apps.multi.co.id/myassetv3/assets/libs/datatables.net/js/jquery.dataTables.min.js"></script>
    <script src="https://apps.multi.co.id/myassetv3/assets/libs/datatables.net-bs4/js/dataTables.bootstrap4.min.js"></script>

    <!-- Buttons examples -->
    <script src="https://apps.multi.co.id/myassetv3/assets/libs/datatables.net-buttons/js/dataTables.buttons.min.js"></script>
    <script src="https://apps.multi.co.id/myassetv3/assets/libs/datatables.net-buttons-bs4/js/buttons.bootstrap4.min.js"></script>
    <script src="https://apps.multi.co.id/myassetv3/assets/libs/jszip/jszip.min.js"></script>
    <script src="https://apps.multi.co.id/myassetv3/assets/libs/datatables.net-buttons/js/buttons.html5.min.js"></script>
    <script src="https://apps.multi.co.id/myassetv3/assets/libs/datatables.net-buttons/js/buttons.print.min.js"></script>
    <script src="https://apps.multi.co.id/myassetv3/assets/libs/datatables.net-buttons/js/buttons.colVis.min.js"></script>

    <script src="https://apps.multi.co.id/myassetv3/assets/libs/datatables.net-keytable/js/dataTables.keyTable.min.js"></script>
    <script src="https://apps.multi.co.id/myassetv3/assets/libs/datatables.net-select/js/dataTables.select.min.js"></script>

    <!-- Responsive examples -->
    <script src="https://apps.multi.co.id/myassetv3/assets/libs/datatables.net-responsive/js/dataTables.responsive.min.js"></script>
    <script src="https://apps.multi.co.id/myassetv3/assets/libs/datatables.net-responsive-bs4/js/responsive.bootstrap4.min.js"></script>
    <script src="https://apps.multi.co.id/myassetv3/assets/js/app.js"></script>

    <!-- Magnific Popup-->
    <script src="https://apps.multi.co.id/myassetv3/assets/libs/magnific-popup/jquery.magnific-popup.min.js"></script>

    <!-- lightbox init js-->
    <script src="https://apps.multi.co.id/myassetv3/assets/js/pages/lightbox.init.js"></script>

    <!-- Chart js-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/1.0.1/Chart.min.js"></script>

    


    <script type="text/javascript">
        $(document).ready(function() {
            $('#datatable').DataTable({
                dom: "<'row'<'col-sm-4'l><'col-sm-5 text-center'B><'col-sm-3'f>>" +
                    "<'row'<'col-sm-12'tr>>" +
                    "<'row'<'col-sm-5'i><'col-sm-7'p>>",

                stateSave: true,

                buttons: [{
                        extend: 'copy',
                        exportOptions: {
                            columns: [0, 1, 2, 3, 4, 5, 6]
                        }
                    },
                    {
                        extend: 'excel',
                        exportOptions: {
                            columns: [0, 1, 2, 3, 4, 5, 6]
                        }
                    },
                    {
                        extend: 'pdf',
                        orientation: 'landscape',
                        exportOptions: {
                            columns: [0, 1, 2, 3, 4, 5, 6]
                        }
                    },
                    {
                        extend: 'print',
                        orientation: 'landscape',
                        exportOptions: {
                            columns: [0, 1, 2, 3, 4, 5, 6]
                        }
                    },
                ],
            });
        });
    </script>

    <script>
        $('#modChart').on('shown.bs.modal', function(event) {
            var link = $(event.relatedTarget);
            // get data source
            var dataUji = link.attr('data-uji').split(',');

            // get title
            var title = link.html();

            // get labels
            var labels = ['rA', 'rB', 'rG', 'stdA', 'stdB', 'stdG', 'absA', 'absB', 'absG'];

            // get target source
            var dataItem = link.attr('data-item').split(',');

            $.each(labels, function(index, value) {
                var a = dataItem.push();
            });
            var a = $('.dataitem_arr').html('Data Item = [' + link.attr('data-uji') + ']');
            var a = $('.datauji_arr').html('Data Uji = [' + link.attr('data-item') + ']');



            // Chart initialisieren
            var modal = $(this);
            var canvas = modal.find('.modal-body canvas');
            modal.find('.modChart-modal-title').html(title);
            var ctx = canvas[0].getContext("2d");
            var chart = new Chart(ctx).Line({
                responsive: true,
                labels: labels,
                datasets: [{
                    fillColor: "rgba(151,187,205,0.2)",
                    strokeColor: "rgba(151,187,205,1)",
                    pointColor: "rgba(151,187,205,1)",
                    pointStrokeColor: "#fff",
                    pointHighlightFill: "#fff",
                    pointHighlightStroke: "rgba(151,187,205,1)",
                    data: dataUji
                }, {
                    fillColor: "rgba(220,220,220,0.2)",
                    strokeColor: "#F7464A",
                    pointColor: "#FF5A5E",
                    pointStrokeColor: "#FF5A5E",
                    pointHighlightFill: "#fff",
                    pointHighlightStroke: "red",
                    data: dataItem
                }]
            }, {});
        }).on('hidden.bs.modal', function(event) {
            // reset canvas size
            var modal = $(this);
            var canvas = modal.find('.modal-body canvas');
            canvas.attr('width', '1000px').attr('height', '450px');
            // destroy modal
            $(this).data('bs.modal', null);
        });
    </script>

</body>

</html>