<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Bootstrap demo</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    
    <!-- line chart -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.5.0/Chart.min.js"></script>
    
</head>
<body>

    {% include 'navbar.html' %}
  
<div class="container mt-5">
    <div class="row"> 

        <!-- Card upload data -->

      <div class="col-md-6" style="width: 436px;">
            <div class="card" style="width: 360px;">
                <div class="card text-center">
                    <div class="card-header">
                        <h4>Uji Tingkat Konsentrasi</h4>
                    </div>
                </div>
                <div class="card-body">

                    <!-- form login -->

                    <form method="post" enctype="multipart/form-data" action="{{url_for('upload_csv')}}">
                        <div class="mb-3">
                            <label for="nip" class="form-label">NIK</label>
                            <input type="text" class="form-control" id="nip" name="nip" placeholder="Masukkan NIP" pattern="[0-9]{1,8}" title="NIP Harus terdiri dari angka dan maksimal 8 karakter" required>
                        </div>
                        <div class="mb-3">
                            <label for="nama_pegawai" class="form-label">Nama Pegawai</label>
                            <input type="text" class="form-control" id="nama_pegawai" name="nama_pegawai" placeholder="Masukkan Nama pegawai"  required> 
                        </div>
                        <div class="mb-3">
                            <label for="departemen" class="from-label">Departemen</label>
                            <select class="from-select" id="departemen" name="departemen">
                                <option value="information_technology">Information Technology</option>
                                <option value="human_capital">Human Capital</option>
                                <option value="finance">Finance</option>
                                <option value="general_affair">General Affair</option>
                            </select>
                        </div>
                        <div class="mb-3">
                          <label for="file" class="from-label">Upload File</label>
                          <input type="file" class="form-control" id="file" name="csv_file" accept=".csv" required>
                         
                        
                          {% if response_message== 'CSV file uploaded successfully' %}
                            <small style="color: blue;">
                              {{response_message}}
                            </small>
                            {% else %}
                            <small style="color: red;">
                              {{response_message}}
                            </small>
                            {% endif %}
                            
                            <!-- Display result -->
                            {% if result %}
                                <div class="result-container">
                                    <h4>Result:</h4>
                                    <p>{{ result }}</p> <!-- Change this to display specific elements of 'result' as needed -->
                                </div>
                            {% endif %}

                      </div>
                        <div class="d-grid">
                            <button type="submit" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#messageModal">Uji Sekarang</button>
                        </div>
                       
                  </form>                                                            
                      
                </div>
            </div>
        </div>

        <!-- Modal -->

        <!-- <div class="modal fade" id="messageModal" tabindex="-1" aria-labelledby="messageModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="messageModalLabel">Message</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        {% if response_message %}
                            <p>{{ response_message }}</p>
                        {% else %}
                            <p>No message to display.</p>
                        {% endif %}
                   
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        <button type="button" class="btn btn-primary">Save changes</button>
                    </div>
                </div>
            </div>
        </div> -->

        <!-- Card Dashboard -->
         <!-- Card Dashboard -->
         <div class="col-md-6">
            <div class="card text-center">
                <div class="card" style="width: 800px; height: auto;">
                    <div class="card-header">
                        <h4>Histori</h4>
                    </div>
                    <div class="container mt-3">
                        <!-- Bagian Pencarian dan Pengurutan -->
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <input type="text" class="form-control" id="searchInput" name="q" placeholder="Kata kunci pencarian">
                            </div>
                            
                            <div class="col-md-3">
                                <select class="form-select" id="sortSelect">
                                    <option value="terbaru">Terbaru</option>
                                    <option value="terlama">Terlama</option>
                                </select>
                            </div>
                            <div class="col mb-3">
                                <div class="col-md-10">
                                    <a href="{{ url_for('export_csv') }}" class="btn btn-primary">Export to CSV</a>
                                </div>
                            </div>
         
<style>
    table,th,td{
        border: 1px solid black;
    }
</style>
                        </div>
                        <!-- Bagian data gelombang otak -->
                        <div class="row">
                            <div class="col-md-12">
                                <table class="table table-stripped" >
                                    <thead>
                                        <tr>
                                            <th>No</th>
                                            <th>NIP</th>
                                            <th>Nama Pegawai</th>
                                            <th>Departemen</th>
                                            <th>Tingkat Konsentrasi</th>
                                            <th>Tanggal</th>
                                        </tr>
                                    </thead>
                                    <tbody id="tableBody">
                                        
                                        {% for data in data %}
                                        <tr>
                                            <td>{{loop.index}} </td>
                                            <td>{{ data.nip }}</td>
                                            <td>{{ data.nama_pegawai }}</td>
                                            <td>{{ data.departemen }}</td>
                                            <td>{{ data.tingkat_konsentrasi }}</td>
                                            <td>{{ data.tanggal }}</td>
                                            <td>
                                                <button class="btn btn-link" onclick="drawLineChart(this)">Show Chart</button>
                                            </td>
                                        </tr>
                                        <tr class="chart-row" style="display: none;">
                                            <td colspan="6">
                                                <div class="chart-cell">
                                                    <canvas class="line-chart"  width="400" height="300"></canvas>
                                                </div>
                                            </td>
                                        </tr>                                
                                                                      
                                        {% endfor %}
                                    </tbody>
                                    

                                   

                                </table>
                            <!-- Bagian Pagination -->
                                <!-- <div class="col-md-12">
                                    <nav aria-label="Page navigation">
                                        <ul class="pagination justify-content-end">
                                            <li class="page-item" id="prevPage">
                                                <a class="page-link" href="#" tabindex="-1" aria-disabled="true">Previous</a>
                                            </li>
                                            
                                            <li class="page-item" id="nextPage">
                                                <a class="page-link" href="#">Next</a>
                                            </li>
                                        </ul>
                                    </nav>
                                </div> -->
                                
                                <script>
                                    function drawLineChart(button) {
                                    const chartRow = button.closest('tr');
                                    const chartContainer = chartRow.nextElementSibling; // Get the next sibling row
                                    const canvas = chartContainer.querySelector('.line-chart');

                                    if (chartContainer.style.display === 'none') {
                                        chartContainer.style.display = 'block';
                                        const dataUji = [0.08185722, 0.09502756, 0.04491122, 0.06503574, 0.05635585, 0.03786717, 0.08185722, 0.09502756, 0.04491122];
                                        const dataItem = [0.02269997, 0.01751783, 0.03700718, 0.04299396, 0.0460799, 0.03779127, 0.02269997, 0.01751783, 0.03700718];
                                        drawChart(canvas, dataUji, dataItem);
                                    } else {
                                        chartContainer.style.display = 'none';
                                    }
                                }

                                    function drawChart(canvas, dataUji, dataItem) {
                                        const ctx = canvas.getContext('2d');
                                        const chartData = {
                                            labels: ['rA', 'rB', 'rG', 'stdA', 'stdB', 'stdG', 'absA', 'absB', 'absG'],
                                            datasets: [
                                                {
                                                    label: 'Data Konsentrasi',
                                                    data: dataUji,
                                                    borderColor: 'blue',
                                                    fill: false
                                                },
                                                {
                                                    label: 'Konsentrasi',
                                                    data: dataItem,
                                                    borderColor: 'red',
                                                    fill: false
                                                }
                                            ]
                                        };

                                        const chartConfig = {
                                            type: 'line',
                                            data: chartData,
                                            options: {
                                                responsive: true,
                                                scales: {
                                                    x: {
                                                        beginAtZero: true
                                                    },
                                                    y: {
                                                        beginAtZero: true
                                                    }
                                                }
                                            }
                                        };

                                        new Chart(ctx, chartConfig);
                                    }
                                </script>

                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Script untuk pencarian -->
<script src="{{url_for('static', filename='js/search.js')}}"></script>
<script src="{{url_for('static', filename='js/filter.js')}}"></script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>

